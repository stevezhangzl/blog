---
title: Makefile相关
date: 2023-10-01 09:48:14
tags:
---

[TOC]

## 01.学习目标

- 熟练掌握Linux下的静态库的制作
- 熟练掌握Linux下的静态库的使用
- 熟练掌握Linux下的共享库的制作
- 熟练掌握Linux下的共享库的使用
- 独立解决动态库加载失败的问题
- 熟练使用规则编写简单的makefile文件
- 熟练使用makefile中的变量
- 熟练使用makefile中的函数
- 熟练掌握gdb相关调试命令的使用



## 02.Makefile简介

一个工程中的源文件不计其数，其按类型、功能、模块分别放在若干个目录中，makefile定义了一系列的规则来指定，哪些文件需要先编译，哪些文件需要后编译，哪些文件需要重新编译，甚至于进行更复杂的功能操作，因为makefile就像一个shell脚本一样，其中也可以执行操作系统的命令。

Makefile带来的好处就是一一“自动化编译”，一旦写好，只需要一个make命令，整个工程完全自动编译，极大的提高了软件开发的效率。make是一个命令工具，是一个解释makefile中指令的命令工具，一般来说，大多数的IDE都有这个命令，比如Delph的make，Visual C++的nmake，Linux下的GNU的make。可见makefile都成为了一种在工程方面的编译方法。

**make主要解决两相问题：**

1）大量代码的关系维护

​			大项目中源代码比较多，手工维护、编译时间长且编译命令复杂，难以记忆及维护

​			把代码维护命令以及编译命令写在makefile文件中，然后再用make 工具解析此文件自动执行相应命令，可以实现代码的合理编译

2）减少重复编译时间

n在改动其中一个文件的时候，能判断哪些文件被修改过，可以只对该文件进行重新编译，然后重新链接所有的目标文件，节省编译时间

**Makefile文件命令规则**

​			makefile和Makefile都可以，推荐使用Makefile。

**make工具的安装**

> sudo apt install make

## 03.Makefile语法规则

一条规则：

> 目标：依赖文件列表
>
> <Tab>命令列表



Makefile基本规则三要素：

1）目标

- 通常是要产生的文件名称，目标可以是可执行文件或其他obj文件，也可以是一个动作的名称

2）依赖文件

- 用来输入从而产生目标文件
- 一个目标通常有几个依赖文件（可以没有）

3）命令：

- make执行的动作，一个规则可以含有几个命令（可以没有）
- 有多个命令时，每个命令占一行



> make -f 1.mk



## 04.make命令格式

make是一个命令工具，它解释Makefile中的指令（应该说是规则）。

make命令模式：

​		make [-f file]\[options]\[targets]

1.[-f file]:

- make默认在工作目录中寻找名为GNUmakefile、makefile、Makefile的文件作为makefile的输入文件
- -f 可以指令以上名字以外的文件作为makefile输入文件



2.[options]

- -v:显示make工具的版本信息
- -w:在处理makefile之前和之后显示工作路径
- -C dir:读取makefile之前改变工作路径至dir目录
- -n:只打印要执行的命令但不执行
- -S:执行但不显示执行的命令



3.[targets]:

- 若使用make命令时没有指定目标，则make工具默认
- 指定了make工具要实现的目标，目标可以



