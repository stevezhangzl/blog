---
title: 博学-Linux文件和系统调用
date: 2023-10-17 15:11:45
tags:
---



# 1.系统调用简介和实现

## 1.1 什么是系统调用

​	系统调用，顾名思义，说的是操作系统提供给用户程序调用的一组‘特殊’接口。用户程序可以通过这组‘特殊’接口来获得操作系统内核提供的服务，比如用户可以通过文件系统相关的调用请求系统打开文件、关闭文件或读写文件，可以通过时钟相关的系统调用获得系统时间或设置定时器等。

​	从逻辑上来说，系统调用可以被看成是一个内核与用户空间程序交互的接口——它好比一个中间人，把用户进程的请求传达给内核，待内核把请求处理完毕后再将处理结果送回给用户空间。

<img src="/Users/zhanglong/Library/Application Support/typora-user-images/image-20231017151718358.png" alt="image-20231017151718358" style="zoom:50%;" />

​	系统服务之所以需求通过系统调用来提供给用户空间的根本原来是为了对系统进行`保护`，因为我们知道Linux的运行空间分为内核空间与用户空间，它们各自运行在不同的级别中，逻辑上相互隔离。

​	所以用户进程在通常情况下不允许访问内核数据，也无法使用内核函数，它们只能在用户空间操作用户数据，调用用户空间的函数。

​	比如我们熟悉的“hello world”程序（执行时）就是标准的用户空间进程，它使用的打印函数printf就属于用户空间函数，打印的字符“hello world”字符串也属于用户空间数据。

​	但是很多情况下，用户进程需要获得系统服务（调用系统程序），这时就必须利用系统提供给用户的“特殊接口”——系统调用了，它的特殊性主要在于规定了用户进程进入内核的具体位置。

​	换句话说，用户访问内核的路径是事先规定好的，只能从规定位置进入内核，而不准许肆意跳入内核。有了这样的陷入内核的统一访问路径限制才能保证内核安全无误。我们可以形象地描述这种机制：作为一个游客，你可以买票要求进入野生动物园，但你必须老老实实地坐在观光车上，按照规定的路线浏览。当然，不准下车，因为那样太危险。



## 1.2 系统调用的实现

​	系统调用是属于操作系统内核的一部分的，必须以某种方式提供给进程让它们去调用。CPU可以在不同的特权级别下运行，而相应的操作系统也有不同的运行级别，`用户态和内核态`。运行在内核态的进程可以毫无限制的访问各种资源，而在用户态下的用户进程的各种操作都有着限制，比如不能随意的访问内存、不能开闭中断以及切换运行特权级别。显然，属于内核的系统调用一定是运行在内核态下，但是如何切换到内核态呢？

​	答案是软件中断。软件中断和我们常说的中断（硬件中断）不同之处在于，它是通过软件指令触发而并发外设引发的中断，也就是说，又是编程人员开发出的一种异常（该异常为正常的异常）。**操作系统一般是通过软中断从用户态切换到内核态。**



# 2.系统调用和库函数的区别

Linux下对文件操作有两种方式：`系统调用`和 `库函数调用`

库函数由两类函数组成：

1）不需要调用系统调用

​		不需要切换到内核空间即可完成函数全部功能，并且将结果反馈给应用程序，如strcpy、bzero等字符串操作函数。

2）需要调用系统调用

​		需要切换到内核空间，这类函数通过封装系统调用去实现相应功能，如printf、fread等。

